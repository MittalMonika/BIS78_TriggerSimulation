#!/bin/sh

# run like so:
#  atl-gpt-mem-profile myjobo.py -c 'EVTMAX=100'
function atl_gpt_mem_profile()
{
    args=("$@")
    atl_gpt_memprofile=atl-gpt-$$.mem.profile
    /bin/rm -rf ${atl_gpt_memprofile}* 2> /dev/null
    echo "::: running gpt-mem-profiler (outfile=$atl_gpt_memprofile)..."
    TCMALLOCDIR=${ATLAS_GPERFTOOLS_DIR} \
    LD_PRELOAD=libtcmalloc_and_profiler.so \
    HEAPPROFILE=$atl_gpt_memprofile \
        `which python` `which athena.py` --stdcmalloc $args
    sc=$?
    echo "::: running gpt-mem-profiler (outfile=$atl_gpt_memprofile)... [done]"
    return $sc
}

atl_gpt_mem_profile "$@"
