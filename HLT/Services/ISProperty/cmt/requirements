package ISProperty

author Sebastian Boeser <sboeser@hep.ucl.ac.uk>

use AtlasPolicy           AtlasPolicy-*
use GaudiInterface        GaudiInterface-*        External
use HLTtdaq               HLTtdaq-*               HLT/HLTExternal

private
use AtlasBoost            AtlasBoost-*            External
use AtlasReflex           AtlasReflex-*           External

# to avoid compiler warning
macro_remove_regexp AtlasCxxPolicy_pp_cppflags "'-DPACKAGE_VERSION=.*'"

end_private

#-------------------------------------------------------------------
# public statements for automated OKS schema building
#-------------------------------------------------------------------
public 

### The make fragments
	make_fragment OKSSchema_header
	make_fragment OKSSchema -suffix=schema.xml -header=OKSSchema_header

### Executable and path names
	macro genOKSCmd    "genOKS.exe"
	macro genOKSDir    "genOKS"
	cmtpath_pattern \
			macro genOKSInstallDir "" \
				 <project>_without_installarea&Unix "$(<package>_root)/share/data" \
				 <project>_with_installarea&Unix "<path>/$(<project>_installarea_prefix)/share/data" ;

### The provided schema
	pattern gen_oks_schema \
		document OKSSchema <library>Schema \
			 library=<library> \
			 outdir=$(<package>_root)/$(genOKSDir) \
			 instdir=$(genOKSInstallDir) \
			 -s=../$(tag) $(library_prefix)<library>.$(shlibsuffix) ; \
		macro_append <library>Schema_dependencies <library>

end_public

#-------------------------------------------------------------------
# building ISProperty library and genOKS executable
#-------------------------------------------------------------------

### ISProperty library
macro_append ISProperty_shlibflags "-lipc -lis"
apply_pattern dual_use_library files="*.cxx"
apply_pattern declare_joboptions files="*.py"
apply_pattern declare_python_modules files="*.py"


### automated OKS schema generation
apply_pattern gen_oks_schema library=ISProperty

### only for this package, make Schema creation depend on genOKS application
private
	macro_append ISPropertySchema_dependencies " genOKS"
end_private
 
### OKS schema builder application
application genOKS -import=Boost -s=../bin genOKS.cxx
macro_append genOKSlinkopts "$(ISProperty_linkopts) $(HLTtdaq_linkopts) $(GaudiKernel_linkopts) $(Boost_linkopts) $(Boost_linkopts_filesystem) $(Boost_linkopts_program_options)"
macro_append genOKSlinkopts "-lipc -lis -loks -lemon" 
macro_append genOKS_dependencies " ISProperty"
 


