package HLTdal

author  Andre.dos.Anjos@cern.ch 
manager Andre.dos.Anjos@cern.ch, Reiner.Hauser@cern.ch

public

use AtlasPolicy           AtlasPolicy-*            
#use AtlasPython           AtlasPython-*            External
#use AtlasBoost            AtlasBoost-*             External

library HLTdal *.cpp
# apply_tag default_linkopts 

private
use HLTtdaq		  HLTtdaq-*                HLT/HLTExternal

# Remove to avoid compiler warning
macro_remove_regexp AtlasCxxPolicy_pp_cppflags "'-DPACKAGE_VERSION=.*'"

use genconfig * -no_auto_imports

macro generate-config-include-dirs "${TDAQ_INST_PATH}/share/data/DFConfiguration ${TDAQ_INST_PATH}/share/data/dal"

document generate-config hltdal -s=../schema/        \
                                namespace="hlt::dal" \
                                include="HLTdal"     \
                                cppdir="../src/"     \
                                prefix="${HLTdal_cmtpath}/${cmt_installarea_prefix}" \
                                hlt.schema.xml

macro_append HLTdal_dependencies " hltdal"
include_dirs $(bin)

# Leave this as _copy since we should not link from 'include' to a platform specific directory
# since it can cause problems in creating the pacman kit
apply_pattern generic_declare_for_copy kind="gen_includes" files="-s=$(bin)  HLTdal" prefix="include/$(package)"
macro_append install_gen_includes_dependencies " hltdal"

apply_pattern generic_declare_for_link kind="schema" files="-s=../schema  hlt.schema.xml" prefix="share/data/daq/schema"
apply_pattern generic_declare_for_link kind="sw" files="-s=../sw  hlt-templates.data.xml" prefix="share/data/daq/sw"

macro HLTdal_shlibflags " ${HLTtdaq_linkopts} -ldaq-df-dal "


# Build Java bindings

apply_tag linux
macro_prepend   classpath                        "${TDAQ_INST_PATH}/share/lib/DFdal.jar:"
macro_prepend   classpath                        "${TDAQ_INST_PATH}/share/lib/config.jar:"
macro_prepend   classpath                        "${TDAQ_INST_PATH}/share/lib/dal.jar:"
apply_pattern   build_jar name=HLTdal            src_dir="$(bin)hltdal.tmp/HLTdal" \
                                                 sources=*.java

document installer install_jars "$(bin)/java/HLTdal.jar"      \
                   install_dir="$(CMTINSTALLAREA)/share/HLTdal"

macro_append    HLTdal.jar_dependencies          hltdal
macro_append    install_jars_dependencies        HLTdal.jar

# A generated application 

application HLTdal_dump     ../src/dump/dump_hlt__dal.cpp
macro HLTdal_dumplinkopts   "-lHLTdal -lipc"
macro HLTdal_dump_dependencies "hltdal HLTdal"
