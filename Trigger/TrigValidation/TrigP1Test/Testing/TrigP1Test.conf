# For a full documentation see:
# http://atlas-sw.cern.ch/cgi-bin/viewcvs-atlas.cgi/offline/Trigger/TrigValidation/TriggerTest/Testing/trigtest.conf?revision=HEAD&view=markup

################################################
# Infrastructure tests
################################################
test 1
  name HelloWorldHLT
  doc HelloWorld in athenaHLT
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -n 10 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data AthExHelloWorld/HelloWorldOptions.py

test 2
  name HelloWorldHLT_run_stop_run
  doc HelloWorld int athenaHLT with start/stop/start transition
  stdinfile run-stop-run-saveHist.trans
  checklog --config checklogTrigP1Test.conf --showexcludestats 
  extra_failure_codes ROOTCOMP_MISMATCH  
  athena_cmd athenaHLT.py -i --rewind -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data AthExHelloWorld/HelloWorldOptions.py

test 3
  name MTMonHistOH
  doc Histogram publishing test with OH infrastructure
  # note testMonHistOH.py invokes athenaHLT with  MTMonHist.py job options 
  # note that MTMonHist.py jo are in the HLT project
  pre_command get_joboptions MTMonHist.py
  athena_cmd testMonHistOH.py /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/atn-test/daq.physicsMCppv2.latest.data
  checklog --config checklogTrigP1Test.conf --showexcludestats


################################################
# MC menu 
################################################
#
# The references are stored for each nightly branch separately.
# The testing script will replace the path "/latest/" below with e.g. "/dev/latest/"
# if the reference file is available. Otherwise the given path will be used.

test 22
  name HLT_MC_run_stop_run
  doc MC menu with start/stop/start transition
  filterlog filterREGTEST.py
  stdinfile run-stop-run-saveHist.trans
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV4.root
  extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED
  pre_condition test -e ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0006._Athena._0001.data
  athena_cmd athenaHLT.py -i --rewind -f ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0006._Athena._0001.data -oHLT_MC_run_stop_run -c'testMCV4MC=True;setPrescale="None";setDetDescr="ATLAS-GEO-16-00-00";setGlobalTag="OFLCOND-DR-BS7T-ANom-11";HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py

test 25
  name AthenaP1BS_standalone
  doc Standalone HLT running in athena and compare to athenaHLT
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1BS_standalone.reference
  rootcomp ../HLT_physicsV5/expert-monitoring.root expert-monitoring.root
  checkcount ../HLT_physicsV5/expert-monitoring.root 0 BOTH 
  athena_cmd athena.py -c "BSRDOInput='root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data';testPhysicsV5=True;rerunLVL1=True;doValidation=True" TriggerRelease/runHLT_standalone.py 
  post_command chainDump.py -n -S

test 26
  name AthenaP1BS_LS1V1_standalone
  doc Standalone HLT running in athena and compare to athenaHLT
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1BS_LS1V1_standalone.reference
  rootcomp ../HLT_LS1V1/expert-monitoring.root expert-monitoring.root
  checkcount ../HLT_LS1V1/expert-monitoring.root 0 BOTH 
  athena_cmd athena.py  -c "BSRDOInput='root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data';testLS1V1=True;doValidation=True;writeBS=True;EvtMax=10" TriggerRelease/runHLT_standalone.py 
  post_command chainDump.py -n -S


###########################################################
# Full menu tests Monte Carlo using AthenaHLT
###########################################################
#
# The references are stored for each nightly branch separately.
# The testing script will replace the path "/latest/" below with e.g. "/dev/latest/"
# if the reference file is available. Otherwise the given path will be used.
#
test 51
  name HLT_MC_BSfromRDO
  doc athenaHLT on MC with MC menu, input from AthenaP1RDOtoBS
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_MC_BSfromRDO.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_MC_BSfromRDO.root 0 BOTH
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_MC_BSfromRDO.root
# note ._0001.data is added automatically
  pre_condition test -e ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0006._Athena._0001.data
  # The geometry and conditions tag need to match the ones used in AthenaP1RDOtoBS
  athena_cmd athenaHLT.py -l DEBUG -f ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0006._Athena._0001.data -c 'HLTOutputLevel=DEBUG;testMCV4MC=True;setDetDescr="ATLAS-GEO-16-00-00";setGlobalTag="OFLCOND-DR-BS7T-ANom-11";setPrescale="";doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command chainDump.py -n -S

################################################
# Athena tests
################################################
#
# The references are stored for each nightly branch separately.
# The testing script will replace the path "/latest/" below with e.g. "/dev/latest/"
# if the reference file is available. Otherwise the given path will be used.
#
# Note that references are on /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/
#                                                                                   ******
#
#  with the exception of the L1 and L1L2 EDM tests.  These are currently on run in full releases (dev, devval, val, bugfix)
# and therefore need to be separated so that they are not deleted when the references in P1HLT are changed.
#

test 53
  name AthenaP1RDO
  doc Athena on Monte Carlo events, produces xml file for menu
  athena_cmd athena.py -c "doRates=False" TrigP1Test/testAthenaP1RDO.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  regtest TrigSteer_L2.TrigChainMoniValidation  REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO_L2.TrigChainMoniValidation.reference
  regtest TrigSteer_EF.TrigChainMoniValidation  REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO_EF.TrigChainMoniValidation.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO.root 1 BOTH
  pre_command RecExCommon_links.sh
  post_command chainDump.py -n -S

test 54
  name AthenaP1RDOtoBS
  doc Run RDO->BS using ttbar MC file
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDOtoBS.reference
  rootcomp /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDOtoBS.root
  athena_cmd athena.py -c 'setMenu="MC_pp_v5";PoolRDOInput=["/afs/cern.ch/atlas/project/trigger/pesa-sw/validation/atn-test/mc10_7TeV.105200.T1_McAtNlo_Jimmy.digit.RDO.e598_s933_s946_d495_25evts.pool.root.1"];myBSRDOOutput="AppName=Athena, OutputDirectory=./, FileTag="+setMenu+", Run=105200"' TriggerRelease/Trigger_topOptions_writeBS.py
  post_command test -e  data_test.00105200.Single_Stream.daq.RAW._lb0006._Athena._0001.data


######################################################################################
#
# tests on real data
#
######################################################################################

test 84
  name  TrigEDMCheck_physicsV4_savedBS
  doc EDMCheck on RAWtoESD_physicsV4_savedBS
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigEDMCheck_physicsV4_savedBS.reference  
  pre_condition test -e ../RAWtoESD_physicsV4_savedBS/data12_physicsV4.ESD.pool.root
  pre_command ln -s ../RAWtoESD_physicsV4_savedBS/data12_physicsV4.ESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigEDMCheck_data.py

test 85
  name  RAWtoESD_physicsV5_savedBS
  doc Reco_tf on saved output from HLT_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_command linktoP1HLT.sh physicsV5
  athena_cmd Reco_tf.py  --inputBSFile link_to_file_from_P1HLT.data --maxEvents 10 --autoConfiguration everything --outputESDFile data12_physicsV5.ESD.pool.root --ignoreErrors True

################################################################################
# Test of LS1_V1  menu: This menu is used during LS1 for milestone and technical runs
################################################################################

test 100
  name HLT_LS1V1
  doc athenaHLT standalone with LS1_V1 menu
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1.root 
  athena_cmd athenaHLT.py -o HLT_LS1V1 -n 10 --use-raw-file-convention 'HLT_LS1V1' -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -c 'testLS1V1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py 
  post_command ln -s data12_8TeV.00212967.physics_EnhancedBias.HLT_LS1V1.RAW._lb0291._athenaHLT._0001.data HLT_LS1V1-1._0001.data	
  post_command save_to_refdir.sh HLT_LS1V1-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S



test 101
  name HLT_LS1V1_menu
  doc Run athenaHLT on all events to create trigger configuration
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -o HLT_LS1V1_menu  -c 'testLS1V1=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py


test 102
  name UploadMenuKeysLS1V1
  doc Generates and uploads SMKs created from the HLT first and compares after rerun jobs from DB.
  pre_condition test -e ../HLT_LS1V1_menu/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../HLT_LS1V1_menu/l2_Default_setup.txt
  pre_condition test -e ../HLT_LS1V1_menu/l2_Default_setup_setup.txt
  pre_condition test -e ../HLT_LS1V1_menu/ef_Default_setup.txt
  pre_condition test -e ../HLT_LS1V1_menu/ef_Default_setup_setup.txt
  athena_cmd testUploadMenuKeys.sh


test 103
  name HLT_LS1V1_rerun 
  doc Recreate trigger configuration and compare with configuration from HLT_LS1V1_menu
  athena_cmd athenaHLT.py -n 1 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -o HLT_LS1V1_rerun -c 'testLS1V1=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py


test 104
  name CheckKeysLS1V1
  doc compare the SMK created from the HLT_LS1V1 first and rerun jobs 
  pre_condition test -e ../HLT_LS1V1_menu/ef_Default_setup.txt 
  pre_condition test -e	../HLT_LS1V1_menu/ef_Default_setup_setup.txt 
  pre_condition test -e ../HLT_LS1V1_rerun/ef_Default_setup.txt 
  pre_condition test -e	../HLT_LS1V1_rerun/ef_Default_setup_setup.txt 
  checklog --config checklogTrigP1Test.conf --showexcludestats | grep -v "checking for"
  athena_cmd testCheckKeys.sh HLT_LS1V1



################################################################################
#  LS1_V1 menu on cosmics
################################################################################

test 107
  name HLT_LS1V1_COS_2012
  doc athenaHLT standalone with LS1_V1 menu on COSMICS 2012
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_2012reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_2012.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_2012.root 
  athena_cmd athenaHLT.py -o HLT_LS1V1_COS_2012 -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_cos.00214912.express_express.merge.RAW._lb0184._SFO-ALL._0001.1  -c 'testLS1V1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py  	
  post_command save_to_refdir.sh HLT_LS1V1_COS_2012-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S

test 108
  name HLT_LS1V1_COS_M4L1MUON
  doc athenaHLT standalone with LS1_V1 menu on COSMICSM4_L1MUON
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_M4L1MUON.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_M4L1MUON.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_M4L1MUON.root 
  athena_cmd athenaHLT.py -o HLT_LS1V1_COS_M4L1MUON -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00233343.physics_L1Muon.merge.RAW/data14_cos.00233343.physics_L1Muon.merge.RAW._lb0002._SFO-ALL.M4._0001.1. -c 'testLS1V1=True;HLTOutputLevel=WARNING;doValidation=True;useCONDBR2=True;setGlobalTag="CONDBR2-HLTP-2014-00"' TriggerRelease/runHLT_standalone.py  	
  post_command save_to_refdir.sh HLT_LS1V1_COS_M4L1MUON-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S


test 109
  name HLT_LS1V1_COS_M4L1CALO
  doc athenaHLT standalone with LS1_V1 menu on COSMICSM4_L1CALO
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_M4L1CALO.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_M4L1CALO.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1_COS_M4L1CALO.root 
  athena_cmd athenaHLT.py -o HLT_LS1V1_COS_M4L1CALO -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00233328.physics_L1Calo.merge.RAW._lb0002._SFO-ALL._0001.1 -c 'testLS1V1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py  	
  post_command save_to_refdir.sh HLT_LS1V1_COS_M4L1CALO-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S



################################################################################
# Further tests  on functionality of LS1_V1 menu: This menu is used during LS1 for milestone and technical runs
################################################################################
test 110
  name RAWtoESD_LS1V1
  doc RAWtoESD on output from HLT_LS1V1
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_condition test -e '../HLT_LS1V1/HLT_LS1V1-1._0001.data'
  athena_cmd  RAWtoESD_tf.py --inputBSFile ../HLT_LS1V1/HLT_LS1V1-1._0001.data  --maxEvents 100  --outputESDFile RAWtoESD.pool.root --ignoreErrors True
  post_command checkFile.py RAWtoESD.pool.root > ESD.txt


test 111
  name TrigEDMCheck_LS1V1
  doc EDM checker on ESD from RAWtoESD_LS1V1
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigEDMCheck_LS1V1.reference
  pre_condition test -e ../RAWtoESD_LS1V1/RAWtoESD.pool.root
  pre_command ln -s ../RAWtoESD_LS1V1/RAWtoESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigEDMCheck_data.py

test 112
  name TrigDecTool_LS1V1
  doc  Check of TrigDec for events produced by RAWtoESD_LS1V1
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigDecTool_LS1V1.reference
  pre_condition test -e ../RAWtoESD_LS1V1/RAWtoESD.pool.root
  pre_command ln -s ../RAWtoESD_LS1V1/RAWtoESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigDecTool.py

test 113
  name HLT_LS1V1_run_stop_run
  doc athenaHLT on data with HLT_LS1V1 menu with stop/start transition
  stdinfile run-stop-run-saveHist.trans
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_LS1V1.root
  #extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED  
  athena_cmd athenaHLT.py -i  --rewind -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oAllMT_LS1V1_run_stop_run -c 'testLS1V1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py

# test for T0 and offline on a BS file produced with P1HLT cache
test 114
  name RAWtoESD_LS1V1_savedBS
  doc RAWtoESD on saved output from HLT_LS1V1
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_command linktoP1HLT.sh LS1V1
  athena_cmd  RAWtoESD_tf.py --inputBSFile link_to_file_from_P1HLT.data  --maxEvents 10  --outputESDFile RAWtoESD.pool.root --ignoreErrors True
  post_command checkFile.py RAWtoESD.pool.root > ESD.txt  



################################################################################
# Test of  MC_pp_V5 menu
################################################################################

test 123
  name HLT_mcV5
  doc AthenaHLT on data, with MC_pp_V5 menu
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.root 
  athena_cmd athenaHLT.py -o HLT_mcV5   -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data -c 'testMCV5=True;rerunLVL1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py 
  post_command ln -s data12_8TeV.00212967.physics_EnhancedBias.HLT_mcV5.RAW._lb0291._athenaHLT._0001.data HLT_mcV5-1._0001.data	
  post_command save_to_refdir.sh HLT_mcV5-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S

test 124
  name RAWtoESD_mcV4_savedBS
  doc RAWtoESD on saved output from HLT_mcV4
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_command linktoP1HLT.sh mcV4
  #athena_cmd RAWtoESD_trf.py inputBSFile=link_to_file_from_P1HLT.data  maxEvents=10 autoConfiguration=everything  preInclude=RecExCommission/RecExCommission.py outputESDFile=data12_mcV4.ESD.pool.root outputDQMonitorFile=monitor.root  --ignoreunknown
  athena_cmd RAWtoESD_trf.py inputBSFile=link_to_file_from_P1HLT.data  maxEvents=10 autoConfiguration=everything  preInclude=RecExCommission/RecExCommission.py outputESDFile=data12_mcV4.ESD.pool.root   --ignoreunknown
  post_command checkFile.py data12_mcV4.ESD.pool.root > ESD.txt  

test 125
  name  TrigEDMCheck_mcV4_savedBS
  doc EDMCheck on RAWtoESD_mcV4_savedBS
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigEDMCheck_mcV4_savedBS.reference  
  pre_condition test -e ../RAWtoESD_mcV4_savedBS/data12_mcV4.ESD.pool.root
  pre_command ln -s ../RAWtoESD_mcV4_savedBS/data12_mcV4.ESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigEDMCheck_data.py
 

#Reco_tf.py verwenden!!!
test 126
  name Reco_trf_mcV4_savedBS
  doc Reco_trf on saved output from HLT_mcV4
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_command linktoP1HLT.sh mcV4
  #athena_cmd Reco_trf.py inputBSFile=link_to_file_from_P1HLT.data maxEvents=10 autoConfiguration=everything outputESDFile=data12_mcV4.ESD.pool.root outputNTUP_TRIGFile=data12_mcV4.D3PD.root HIST=myMergedMonitor.root --ignoreunknown   
  athena_cmd Reco_trf.py inputBSFile=link_to_file_from_P1HLT.data maxEvents=10 autoConfiguration=everything outputESDFile=data12_mcV4.ESD.pool.root  --ignoreunknown

################################################################################
# Test of Physics_pp_V5 menu
################################################################################

test 130
  name HLT_physicsV5
  doc athenaHLT on data with Physics_pp_v5 menu
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root 1 L2
  athena_cmd athenaHLT.py -o HLT_physicsV5  -n 10 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data -c 'testPhysicsV5=True;rerunLVL1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command ln -s data12_8TeV.00212967.physics_EnhancedBias.HLT_physicsV5.RAW._lb0291._athenaHLT._0001.data HLT_physicsV5-1._0001.data	
  post_command save_to_refdir.sh HLT_physicsV5-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference 


test 132
  name CheckKeysV5
  doc compare the SMK created from the HLT_physicsV5 first and rerun jobs 
  pre_condition test -e ../HLT_physicsV5_menu/ef_Default_setup.txt 
  pre_condition test -e	../HLT_physicsV5_menu/ef_Default_setup_setup.txt 
  pre_condition test -e ../HLT_physicsV5_rerun/ef_Default_setup.txt 
  pre_condition test -e	../HLT_physicsV5_rerun/ef_Default_setup_setup.txt 
  checklog --config checklogTrigP1Test.conf --showexcludestats | grep -v "checking for"
  athena_cmd testCheckKeys.sh

test 133
  name HLT_physicsV5_menu
  doc Run athenaHLT on all events to create trigger configuration
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -o HLT_physicsV5_menu  -c 'testPhysicsV5=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py

test 135
  name UploadMenuKeys
  doc Generates and uploads SMKs created from the All*T first and compares after rerun jobs from DB.
  pre_condition test -e ../AllMT_physicsV4_menu/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../AllMT_physicsV4_menu/l2_Default_setup.txt
  pre_condition test -e ../AllMT_physicsV4_menu/l2_Default_setup_setup.txt
  pre_condition test -e ../AllPT_physicsV4_menu/ef_Default_setup.txt
  pre_condition test -e ../AllPT_physicsV4_menu/ef_Default_setup_setup.txt
  athena_cmd testUploadMenuKeys.sh

test 136
  name AllMT_physicsV4_menu_rerundb
  doc athenaMT from DB, use AllMT_physicsV4 as reference
  checklog --config checklogTrigP1Test.conf --showexcludestats
  rootcomp   ../AllMT_physicsV4_menu/r0000000000_athena_mon_Histogramming-L2-Segment-1-1-iss.root r0000000000_athena_mon_Histogramming-L2-Segment-1-1-iss.root
  extra_failure_codes ROOTCOMP_MISMATCH  
  pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  athena_cmd source ../UploadMenuKeys/exportMenuKeys.sh; athenaMT.py -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oAllMT_physicsV4_menu_rerundb -J TrigConf::HLTJobOptionsSvc --use-database "DBServer=TRIGGERDBATN:Instance=L2:DBSMKey=${smk}:DBHLTPSKey=${hltpsk}:DBLVL1PSKey=${l1psk}" 
  post_command chainDump.py -n -S
  post_test RunMsg check_msg_stat.py --showignored --config checkMsgStat_TrigP1Test.conf $logfile

test 138
  name AllMT_physicsV4_prescaleChange
  doc Test of HLT prescale change
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  pre_condition test -e ../UploadMenuKeys/prescales.txt
  pre_command ln -sf ../UploadMenuKeys/prescales.txt
  pre_command get_files -jo testPrescaleChange_postconfig.py
  athena_cmd source ../UploadMenuKeys/exportMenuKeys.sh; athenaMT.py -Z TrigP1Test.PrescaleChange -C 'include("testPrescaleChange_postconfig.py")' -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -J TrigConf::HLTJobOptionsSvc --use-database "DBServer=TRIGGERDBATN:Instance=L2:DBSMKey=${smk}:DBHLTPSKey=${hltpsk}:DBLVL1PSKey=${l1psk}"

test 139
  name TriggerDBAccessTest
  doc Access TriggerDB using Oracle and Frontier and compare
# pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  athena_cmd testAccessDBAndCompare.sh

  
test 150
  name RAWtoESD_physicsV5
  doc RAWtoESD on output from HLT_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_condition test -e '../HLT_physicsV5/HLT_physicsV5-1._0001.data'
  athena_cmd RAWtoESD_trf.py inputBSFile=../HLT_physicsV5/HLT_physicsV5-1._0001.data  maxEvents=5 autoConfiguration=everything  preInclude=RecExCommission/RecExCommission.py preExec='rec.doESD.set_Value_and_Lock(False)'  outputESDFile=RAWtoESD.pool.root --ignoreunknown
  post_command checkFile.py RAWtoESD.pool.root > ESD.txt

test 151
  name TrigEDMCheck_physicsV5
  doc EDM checker on ESD from RAWtoESD_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigEDMCheck_physicsV5.reference
  pre_condition test -e ../RAWtoESD_physicsV5/RAWtoESD.pool.root
  pre_command ln -s ../RAWtoESD_physicsV5/RAWtoESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigEDMCheck_data.py

test 152
  name TrigDecTool_physicsV5
  doc  Check of TrigDec for events produced by RAWtoESD_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigDecTool_physicsV5.reference
  pre_condition test -e ../RAWtoESD_physicsV5/RAWtoESD.pool.root
  pre_command ln -s ../RAWtoESD_physicsV5/RAWtoESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigDecTool.py

test 153
  name HLT_physicsV5_run_stop_run
  doc athenaHLT on data with physics_pp_V5 menu with stop/start transition
  stdinfile run-stop-run-saveHist.trans
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root
  #extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED  
# -i is interactive
  athena_cmd athenaHLT.py -i  --rewind -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oAllMT_physicsV5_run_stop_run -c 'testPhysicsV5=True;rerunLVL1=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py

test 155
  name HLT_physicsV5_rerun 
  doc Recreate trigger configuration and compare with configuration from HLT_physicsV5_menu
  athena_cmd athenaHLT.py -n 1 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -o HLT_physicsV5_rerun -c 'testPhysicsV5=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py
 
test 157
  name AllPartition_physicsV4
  doc Physics_pp_v4 menu in localhost L2+EF partition
  joboptions runHLT_standalone.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd part_runTest.sh part_lhl2ef 
  customregtest part_regtest.sh ../AllMT_physicsV4/AllMT_physicsV4.reference.new ../AllPT_physicsV4/AllPT_physicsV4.reference.new  
  customrootcomp part_rootcomp.sh ../AllMT_physicsV4/expert-monitoring.root  ../AllPT_physicsV4/expert-monitoring.root
  post_command cleanuplog.sh runHLT_standalone_test.log

test 158
  name AllMT_physicsV4_magField_on_off_on
  doc athenaMT on data with physicsV4 menu with On and Off magnetic field transition
  pre_command  get_files -jo setMagFieldCurrents.py
  stdinfile magFieldOnOff.trans
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log 1 3
  rootcomp run_1.root run_2.root
  extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED  
# -i is interactive, -M turns on monitoring
  athena_cmd athenaMT.py -i -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oAllMT_physicsV4_magField_on_off_on -c 'testPhysicsV4=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py

test 160
  name AllMT_physicsV4_beamspot
  doc Test of beamspot udpate with athenaMT
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaMT.py -Z TrigP1Test.BeamSpotUpdate -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -c 'testPhysicsV4=True;doValidation=True;BeamspotFromSqlite=True' TriggerRelease/runHLT_standalone.py

test 161
  name AllMT_physicsV4_nocache
  doc athenaMT on data with physics_pp_v4 menu, no caching in steering, use AllMT_physicsV4 as reference
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  checkcount ../AllMT_physicsV4/expert-monitoring.root 0 L2
  athena_cmd athenaMT.py -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oAllMT_physicsV4_nocache  -c 'testPhysicsV4=True;noCaching=True;HLTOutputLevel=WARNING;doValidation=True' TriggerRelease/runHLT_standalone.py

test 163
  name TrfTestPPV4
  doc Check Trf for menu PP V4 data
  pre_command xrdcp root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data .
  pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd source ../UploadMenuKeys/exportMenuKeys.sh; BatchHLTTrf_wrap.py inputBSFile=data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data outputRAWFile=RAW.999999._000001.data.1 doStreaming=True filters="express" stream_out=debug connection=TRIGGERDBATN smk=${smk} lvl1ps=${l1psk} hltps=${hltpsk} outputNTUP_TRIGCOSTEFFile=NTUP_TRIGCOSTEF.root outputNTUP_TRIGCOSTL2File=NTUP_TRIGCOSTL2.root outputNTUP_TRIGRATEEFFile=NTUP_TRIGRATEEF.root outputNTUP_TRIGRATEL2File=NTUP_TRIGRATEL2.root outputHIST_HLTMONEFFile=HIST_HLTMONEF.root outputHIST_HLTMONL2File=HIST_HLTMONL2.root max_events=10


################################################################################
# Test of mcV4 menu for CAF reprocessing 
################################################################################

test 180
  name AllMT_mcV4_caf
  doc athenaMT on data with MC_pp_V4 menu for caf reprocessing  
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaMT.py -n 1 -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data  -oAllMT_mcV4_caf  -c 'testMCV4=True;caf=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py

test 182
  name AllMT_physicsV4_caf
  doc athenaMT on data with Physics_pp_V4 menu for caf reprocessing  
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaMT.py -n 1 -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data  -oAllMT_physicsV4_caf  -c 'testPhysicsV4=True;caf=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py

test 184
  name PrepareMenuKeys_physicsV4_caf
  doc Prepares SMKs created from the All*T_physicsV4_caf  tests
  pre_condition test -e ../AllMT_physicsV4_caf/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../AllMT_physicsV4_caf/l2_Default_setup.txt
  pre_condition test -e ../AllMT_physicsV4_caf/l2_Default_setup_setup.txt
  pre_condition test -e ../AllPT_physicsV4_caf/ef_Default_setup.txt
  pre_condition test -e ../AllPT_physicsV4_caf/ef_Default_setup_setup.txt

  athena_cmd testPrepareMenuKeysSelfX.sh physicsV4_caf


test 185
  name PrepareMenuKeys_mcV4_caf
  doc Prepares SMKs created from the All*T_mcV4_caf tests
  pre_condition test -e ../AllMT_mcV4_caf/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../AllMT_mcV4_caf/l2_Default_setup.txt
  pre_condition test -e ../AllMT_mcV4_caf/l2_Default_setup_setup.txt
  pre_condition test -e ../AllPT_mcV4_caf/ef_Default_setup.txt
  pre_condition test -e ../AllPT_mcV4_caf/ef_Default_setup_setup.txt

  athena_cmd testPrepareMenuKeysSelfX.sh mcV4_caf 

test 186
  name PrepareMenuKeys_p1
  doc Prepares SMKs created from the  All*T_physicsV4_menu test 
  pre_condition test -e ../AllMT_physicsV4_menu/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../AllMT_physicsV4_menu/l2_Default_setup.txt
  pre_condition test -e ../AllMT_physicsV4_menu/l2_Default_setup_setup.txt
  pre_condition test -e ../AllPT_physicsV4_menu/ef_Default_setup.txt
  pre_condition test -e ../AllPT_physicsV4_menu/ef_Default_setup_setup.txt

  athena_cmd testPrepareMenuKeysSelfX.sh physicsV4_menu 
