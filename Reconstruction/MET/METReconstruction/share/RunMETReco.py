import AthenaPoolCnvSvc.ReadAthenaPool
from AthenaCommon.AthenaCommonFlags import athenaCommonFlags
from AthenaCommon.AppMgr import ServiceMgr
from AthenaCommon import CfgMgr

filelist = ["myAOD.pool.root"]
from glob import glob
#filelist = glob('/r03/atlas/khoo/Data_2014/DC14xAOD/mc14_8TeV.117050.PowhegPythia_P2011C_ttbar.merge.AOD.e1727_s1933_s1911_r5591_r5625/*')
#filelist = glob('/r03/atlas/khoo/Data_2014/DC14xAOD/mc14_13TeV.110401.PowhegPythia_P2012_ttbar_nonallhad.merge.AOD.e2928_s1982_s2008_r5787_r5853/*')
ServiceMgr.EventSelector.InputCollections = filelist

#import METReconstruction.METConfig_RefFinal

from METReconstruction.METRecoFlags import metFlags

##############################################################################

from AthenaCommon.AppMgr import ToolSvc
from AthenaCommon.AlgSequence import AlgSequence
topSequence = AlgSequence()

##############################################################################

metFlags.DoPFlow.set_Value_and_Lock(False)

from AthenaCommon.Resilience import protectedInclude
protectedInclude("METReconstruction/METReconstruction_jobOptions.py")

write_xAOD = True
if write_xAOD:

    # The list of output containers/maps is autogenerated and stored in metFlags
    # This jO extracts them with the appropriate formatting
    protectedInclude("METReconstruction/METReconstructionOutputAODList_jobOptions.py")

    from OutputStreamAthenaPool.MultipleStreamManager import MSMgr
    xaodStream = MSMgr.NewPoolRootStream( "StreamAOD", "xAOD.8TeV.pool.root" )
    for item in MissingETAODList:
        xaodStream.AddItem(item)

from PerfMonComps.PerfMonFlags import jobproperties as pmon_properties
pmon_properties.PerfMonFlags.doSemiDetailedMonitoring=True

# assocRefAlg.OutputLevel=VERBOSE
# topSequence.METAssociation.OutputLevel=VERBOSE
# ToolSvc.MET_AssociationTool_AntiKt4LCTopo.OutputLevel=VERBOSE
# ToolSvc.MET_LCJetAssocTool_AntiKt4LCTopo.OutputLevel=VERBOSE
# ToolSvc.MET_PhotonAssociator_AntiKt4LCTopo.OutputLevel=VERBOSE
# ToolSvc.MET_SoftAssociator_AntiKt4LCTopo.OutputLevel=VERBOSE
# ToolSvc.MET_JetTool_RefFinal2.OutputLevel=VERBOSE
# ToolSvc.METMaker_AntiKt4LCTopo.OutputLevel=VERBOSE
# ToolSvc.METMaker_Test.OutputLevel=VERBOSE

theApp.EvtMax = 40
ServiceMgr.EventSelector.SkipEvents = 0
ServiceMgr.MessageSvc.defaultLimit = 99999
